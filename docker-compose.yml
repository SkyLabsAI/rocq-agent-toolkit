services:
  backend:
    build:
      context: ../
      dockerfile: rocq_agent_toolkit/backend/Dockerfile
    container_name: rocq-agent-toolkit-backend
    ports:
      # HOST:CONTAINER
      - "${BACKEND_PORT:-8000}:8000"
    environment:
      - JSONL_RESULTS_PATH=/brick_agents
      - OBSERVABILITY_URL=${OBSERVABILITY_URL:-http://loki:3100}
    volumes:
      # When setting the env from docker compose set the path of jsonl here 
      - ${JSONL_VOLUME_PATH:-../brick_agents}:/brick_agents
    networks:
      - rocq-agent-network

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: rocq-agent-toolkit-frontend
    ports:
      - "${FRONTEND_PORT:-3005}:3005"
    networks:
      - rocq-agent-network
    environment:
      - NODE_ENV=${NODE_ENV:-production}
      - NEXT_PUBLIC_DATA_API=${NEXT_PUBLIC_DATA_API:-http://localhost:8000/api}

networks:
  rocq-agent-network:
    external: true
    name: rocq-agent-network