(* ATD schema for task output in the Rocq pipeline *)

type task_status = [ Success | Failure ]

type failure_reason = [
  | Timeout
  | ProofVerificationFailed
  | MaxLLMCallsReached
  | ExecutionError
  | Other of string
]

type token_counts = {
  input_tokens: int;
  output_tokens: int;
  total_tokens: int;
}

type resource_usage = {
  execution_time_sec: float;
  cpu_time_sec: float;
  gpu_time_sec: float;
}

type metrics = {
  llm_invocation_count: int;
  token_counts: token_counts;
  resource_usage: resource_usage;
}

type proof_outputs = {
  generated_proof: string;
}

type task_output = {
  run_id: string;
  task_id: string;
  trace_id: string option;
  timestamp_utc: string; (* ISO 8601 format *)
  (* NOTE: in the future we may want to store additional metadata
     for reproducibility/comparison purposes
   *)
  agent_name: string;
  status: task_status;
  failure_reason: failure_reason option;
  metrics: metrics option;
  outputs: proof_outputs;
}
