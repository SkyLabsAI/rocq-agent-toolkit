<doc text="Per-task output format of the Rocq pipeline.">

type task_status <doc text="Task status upon completion."> = [
  | Success <doc text="Task completed successfully.">
  | Failure <doc text="Task failed.">
]

type resource_exhaustion_kind <doc text="Kind of resource exhaustion."> = [
  | Timeout of int <doc text="Exceeded timelimit in seconds.">
  | MaxLLMCalls of int <doc text="Exceeded LLM call limit.">
]

type failure_reason <doc text="Reason for task failure."> = [
  | ResourceExhaustion of resource_exhaustion_kind <doc text="Resource exhaustion.">
  | ExecutionError of string <doc text="Unrecoverable error.">
  | Other of string <doc text="User defined failure reason.">
]

type token_counts <doc text="Aggregated LLM token metrics for task."> = {
  ~input_tokens <doc text="Total LLM input tokens for task."> : int;
  ~output_tokens <doc text="Total LLM output tokens for task."> : int;
  ~total_tokens <doc text="Total LLM tokens for task."> : int;
}

type resource_usage <doc text="Aggregated execution time metrics for task."> = {
  ~execution_time_sec <doc text="Total execution time for task."> : float;
  ~cpu_time_sec <doc text="Total CPU execution time for task."> : float;
  ~gpu_time_sec <doc text="Total GPU execution time for task."> : float;
}

type metrics <doc text="Aggregated metrics for task."> = {
  ~llm_invocation_count <doc text="Total LLM calls for task."> : int;
  token_counts <doc text="Aggregated LLM token metrics for task."> : token_counts;
  resource_usage <doc text="Aggregated execution time metrics for task."> : resource_usage;
}

type proof_outputs <doc text="Final proof script for completed proof task."> = {
  generated_proof <doc text="Final proof script for completed proof task."> : string;
}

type task_output <doc text="Agent output for a single task."> = {
  run_id <doc text="Unique identifier for the run (UUID)."> : string;
  task_id <doc text="Unique task identifier (file+task locator)."> : string;
  ?trace_id <doc text="Unique trace identifier for corresponding opentelemetry output."> : string option;
  timestamp_utc <doc text="Timestamp when task began (ISO 8601)."> : string;
  (* NOTE: in the future we may want to store additional metadata
     for reproducibility/comparison purposes
   *)
  agent_name <doc text="Unique name of the agent that attempted the task."> : string;
  status <doc text="Task status upon completion."> : task_status;
  ?failure_reason <doc text="Reason for task failure."> : failure_reason option;
  metrics <doc text="Aggregated metrics for task."> : metrics;
  outputs <doc text="Final proof script for completed task."> : proof_outputs;
}
