services:
  database:
    build:
      context: ./database
      dockerfile: Dockerfile
    container_name: rocq-agent-toolkit-db
    # external port can be removed : communication with in the network.
    ports:
      - "${DB_PORT:-5433}:5432"
    environment:
      - POSTGRES_USER=${POSTGRES_USER:-rat_user}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-rat_password}
      - POSTGRES_DB=${POSTGRES_DB:-rat_db}
    volumes:
      - rat_db_data:/var/lib/postgresql/data
    networks:
      - rocq-agent-network

  #Adding pg admin for Visualization of the database 
  # pgadmin:
  #   image: dpage/pgadmin4
  #   container_name: rocq-agent-toolkit-pgadmin
  #   ports:
  #     - "5050:80"
  #   environment:
  #     - PGADMIN_DEFAULT_EMAIL=admin@example.com
  #     - PGADMIN_DEFAULT_PASSWORD=admin
  #   depends_on:
  #     - database
  #   networks:
  #     - rocq-agent-network


  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: rocq-agent-toolkit-backend
    ports:
      # HOST:CONTAINER
      - "${BACKEND_PORT:-8010}:8010"
    environment:
      - OBSERVABILITY_URL=${OBSERVABILITY_URL:-http://loki:3100}
      # Database configuration
      # Use the psycopg v3 driver and the internal PostgreSQL port (5432)
      - DATABASE_URL=postgresql+psycopg://${POSTGRES_USER:-rat_user}:${POSTGRES_PASSWORD:-rat_password}@database:5432/${POSTGRES_DB:-rat_db}
      - POSTGRES_HOST=database # Internal host name for the database container
      - POSTGRES_PORT=5432  # Internal port for the database container
      - POSTGRES_USER=${POSTGRES_USER:-rat_user}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-rat_password}
      - POSTGRES_DB=${POSTGRES_DB:-rat_db}
    networks:
      - rocq-agent-network

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        NEXT_PUBLIC_DATA_API: ${NEXT_PUBLIC_DATA_API:-http://localhost:8010/api}
    container_name: rocq-agent-toolkit-frontend
    ports:
      - "${FRONTEND_PORT:-3005}:3005"
    networks:
      - rocq-agent-network

networks:
  rocq-agent-network:
    external: true
    name: rocq-agent-network

volumes:
  rat_db_data:
